<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="吾生也有涯，而知也无涯！以有涯随无涯，殆已；已而为知者，殆而已矣。"><meta name="keywords" content="LepinHeiker,h5,git,js"><title>基于React Native的热更新 | LepinHeiker</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">基于React Native的热更新</h1><a id="logo" href="/.">LepinHeiker</a><p class="description">吾生也有涯，而知也无涯！以有涯随无涯，殆已；已而为知者，殆而已矣。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">基于React Native的热更新</h1><div class="post-meta"><a href="/2019/03/15/code-push/#comments" class="comment-count"></a><p><span class="date">Mar 15, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h2 id="1-文档目的"><a href="#1-文档目的" class="headerlink" title="1.文档目的"></a>1.文档目的</h2><p>基于React Native的热更新,使用react-native-code-push,这里先记录其最基本的用法,便于工作查阅,后期再逐步完善其配置和用法<br>参考网址: <a href="https://www.jianshu.com/p/8f7ae770a5ac" target="_blank" rel="noopener">react-native-code-push常用命令</a></p>
<h2 id="2-发布热更新等常用命令"><a href="#2-发布热更新等常用命令" class="headerlink" title="2.发布热更新等常用命令"></a>2.发布热更新等常用命令</h2><p>查看服务器app部署情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code-push app list</span><br></pre></td></tr></table></figure></p>
<p>查看发布信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code-push deployment ls Rasog-android -k</span><br></pre></td></tr></table></figure></p>
<p>发布命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code-push release-react Rasog-android android --t 1.0.0 --d Staging --des &quot;1.调整新增整治清单字段\n2.调整编辑整治清单时照片可删除&quot; --m true</span><br></pre></td></tr></table></figure></p>
<p>其他常用命令</p>
<ul>
<li><code>code-push app add</code> 在账号里面添加一个新的app</li>
<li><code>code-push app remove</code> 或者 rm 在账号里移除一个app</li>
<li><code>code-push app rename</code> 重命名一个存在app</li>
<li><code>code-push app list</code> 或则 ls 列出账号下面的所有app</li>
<li><code>code-push app transfer</code> 把app的所有权转移到另外一个账号</li>
<li>code-push app ls 查看已注册的应用</li>
<li>code-push deployment ls appName -k  查看应用key</li>
<li>code-push login 登陆 </li>
<li>code-push loout 注销</li>
<li>code-push access-key ls 列出登陆的token</li>
<li>code-push access-key rm <accesskye> 删除某个 access-key</accesskye></li>
<li>code-push app add <appname> <platform> react-native  在账号里面添加一个新的app</platform></appname></li>
<li>code-push app remove 或者 rm 在账号里移除一个 app</li>
<li>code-push app rename 重命名一个存在 app</li>
<li>code-push app list 或则 ls 列出账号下面的所有 app</li>
<li>code-push app transfer 把app的所有权转移到另外一个账号</li>
<li>code-push deployment add <appname> 部署</appname></li>
<li>code-push deployment rm <appname> 删除部署</appname></li>
<li>code-push deployment rename <appname> 重命名</appname></li>
<li>code-push deployment ls <appname> 列出应用的部署情况</appname></li>
<li>code-push deployment ls <appname> -k 查看部署的key</appname></li>
<li>code-push deployment history <appname> <deploymentname> 查看历史版本<h2 id="3-配置本地部署"><a href="#3-配置本地部署" class="headerlink" title="3.配置本地部署"></a>3.配置本地部署</h2></deploymentname></appname></li>
</ul>
<ol>
<li><p>登录本地服务</p>
<blockquote>
<p><code>code-push login http://61.185.20.20:2312/</code> （公网地址）、</p>
<p>会自动打开浏览器  登录后 点击获取token，</p>
<p>在 <code>Enter your token from the browser:</code> 输入 获取的token</p>
<p><code>Successfully logged-in. Your session file was written to /Users/xxxx/.code-push.config. You can run the code-push logout command at any time to delete this file and terminate your session.</code></p>
</blockquote>
</li>
<li><p>本地私有化部署方案参考：<code>https://www.cnblogs.com/shuoer/p/9581886.html</code></p>
</li>
<li><p>在<code>CodePush</code>服务器注册app，为了让CodePush服务器知道你的app，我们需要向它注册app：</p>
<p>在终端输入<code>code-push app add &lt;appName&gt;</code>即可完成注册；私有化服务器要求的参数更多<code>code-push app add &lt;appName&gt; &lt;os&gt; &lt;platform&gt;</code>，并且<code>appName</code>要加<code>-android</code>或者<code>-ios</code>结尾，然后是平台，最后加上是<code>react-native</code>或者<code>Cordova</code>，因为<code>code-push</code>支持这两种应用,例如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code-push app add Rasog-android android react-native</span><br></pre></td></tr></table></figure>
<p>成功后：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Successfully added the <span class="string">"Rasog-android"</span> app, along with the following default deployments:</span><br><span class="line">┌────────────┬───────────────────────────────────────┐</span><br><span class="line">│ Name       │ Deployment Key                        │</span><br><span class="line">├────────────┼───────────────────────────────────────┤</span><br><span class="line">│ Production │ 4ZfN5udhhOftT2ND95gHZr98nmyA4ksvOXqog │</span><br><span class="line">├────────────┼───────────────────────────────────────┤</span><br><span class="line">│ Staging    │ ZymGYYCM6PMwHlwDWef9zCXu8LbC4ksvOXqog │</span><br><span class="line">└────────────┴───────────────────────────────────────┘</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="4">
<li>注册完成之后会返回一套<code>deployment key</code>，分为生成环境<code>Production</code>和<code>Staging</code>，该<code>key</code>在后面客户端集成sdk中会用到。</li>
</ol>
<h3 id="集成CodePush-SDK-for-Android"><a href="#集成CodePush-SDK-for-Android" class="headerlink" title="集成CodePush SDK (for Android)"></a>集成CodePush SDK (for Android)</h3><ol>
<li><p>在项目中安装<code>react-native-code-push</code>插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-native-code-push</span><br><span class="line">react-native link react-native-code-push</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在终端运行此命令之后，终端会提示让你输入<code>deployment key</code>，这是你只需将你的<code>deployment Staging key</code>输入进去即可</p>
</blockquote>
</li>
<li><p>Link 完成后会自动添加一些代码。因为服务是私有部署，需要修改 更新地址。修改<code>android/app/src/main/java/MainApplication.java</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected List&lt;ReactPackage&gt; <span class="function"><span class="title">getPackages</span></span>() &#123;</span><br><span class="line">      <span class="built_in">return</span> Arrays.&lt;ReactPackage&gt;asList(</span><br><span class="line">          new MainReactPackage(),</span><br><span class="line">            new CodePush(getResources().getString(R.string.reactNativeCodePush_androidDeploymentKey), getApplicationContext(), BuildConfig.DEBUG,<span class="string">"http://61.185.20.20:2312"</span>),</span><br><span class="line">            .....</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在<code>new CodePush()</code>最后添加一个参数就是本地服务的地址。</p>
</li>
<li><p>修改rn工程的 入口文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入code-push</span></span><br><span class="line"><span class="keyword">import</span> CodePush <span class="keyword">from</span> <span class="string">'react-native-code-push'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> codePushOptions = &#123; <span class="attr">checkFrequency</span>: CodePush.CheckFrequency.ON_APP_RESUME &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CodePush 是一个高阶组件  还包含一些方法。</span></span><br><span class="line"><span class="comment">// sync</span></span><br><span class="line">componentDidMount () &#123;</span><br><span class="line">    <span class="keyword">this</span>._updateApp()</span><br><span class="line">    AppState.addEventListener(<span class="string">'change'</span>, newState =&gt; &#123;</span><br><span class="line">      newState === <span class="string">'active'</span> &amp;&amp; <span class="keyword">this</span>._updateApp()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// code-push 热更新</span></span><br><span class="line">  _updateApp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    CodePush.sync(&#123;</span><br><span class="line">      installMode: CodePush.InstallMode.IMMEDIATE, <span class="comment">// 启动模式三种：ON_NEXT_RESUME、ON_NEXT_RESTART、IMMEDIATE</span></span><br><span class="line">      updateDialog: &#123;</span><br><span class="line">        appendReleaseDescription: <span class="literal">true</span>, <span class="comment">// 是否显示更新description，默认为false</span></span><br><span class="line">        descriptionPrefix: <span class="string">'更新内容：\n'</span>, <span class="comment">// 更新说明的前缀。 默认是” Description:</span></span><br><span class="line">        mandatoryContinueButtonLabel: <span class="string">'立即更新'</span>, <span class="comment">// 强制更新的按钮文字，默认为continue</span></span><br><span class="line">        mandatoryUpdateMessage: <span class="string">''</span>, <span class="comment">// - 强制更新时，更新通知. Defaults to “An update is available that must be installed.”.</span></span><br><span class="line">        optionalIgnoreButtonLabel: <span class="string">'稍后'</span>, <span class="comment">// 非强制更新时，取消按钮文字,默认是ignore</span></span><br><span class="line">        optionalInstallButtonLabel: <span class="string">'更新'</span>, <span class="comment">// 非强制更新时，确认文字. Defaults to “Install”</span></span><br><span class="line">        optionalUpdateMessage: <span class="string">'有新版本了，是否更新？\n'</span>, <span class="comment">// 非强制更新时，更新通知. Defaults to “An update is available. Would you like to install it?”.</span></span><br><span class="line">        title: <span class="string">'更新提示'</span> <span class="comment">// 要显示的更新通知的标题. Defaults to “Update available”.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//最后导出组件时，需要被CodePush包裹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CodePush(codePushOptions)(App)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>至此就完成了 code-push for android 的配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code-push release-react MyAppAndroid android --t 1.0.0 --dev <span class="literal">false</span> --d Production --des <span class="string">"更新测试"</span> --m <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/React/">React</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2019/03/19/android-apk/" class="pre">基于React Native的android打包</a><a href="/2019/03/14/serve/" class="next">serve静态资源服务器</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-文档目的"><span class="toc-text">1.文档目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-发布热更新等常用命令"><span class="toc-text">2.发布热更新等常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-配置本地部署"><span class="toc-text">3.配置本地部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#集成CodePush-SDK-for-Android"><span class="toc-text">集成CodePush SDK (for Android)</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/tool/" style="font-size: 15px;">tool</a> <a href="/tags/JS/" style="font-size: 15px;">JS</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.ruanyifeng.com/blog/javascript/" title="阮一峰js博客" target="_blank">阮一峰js博客</a><ul></ul><a href="http://es6.ruanyifeng.com/" title="ES6教程" target="_blank">ES6教程</a><ul></ul><a href="https://www.githubs.cn/" title="Github中文社区" target="_blank">Github中文社区</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Xiaobo Zhu.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>